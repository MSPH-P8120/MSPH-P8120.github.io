<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="R.html">R</a>
</li>
<li>
  <a href="SAS.html">SAS</a>
</li>
<li>
  <a href="mailto:&lt;cmm2212@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/MSPH-P8120/MSPH-P8120.github.io">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">R</h1>

</div>


<div id="getting-started" class="section level3">
<h3>Getting started</h3>
<p>This document is intended to be used as a guide to R for P8120: Analysis of Categorical Data. This document is not exhaustive; please consult one of the TA’s, Dr. Mauro, or the internet for more help if needed.</p>
<p>R can be downloaded <a href="https://cran.cnr.berkeley.edu/">here</a> and R Studio (an IDE recommended when using R) can be downloaded <a href="https://www.rstudio.com/products/rstudio/download/">here</a>. We will only support the use of R with RStudio. Even if you already have R and/or RStudio on your computer, we recommended updating to the newest versions available.</p>
<p>R is an open-source functional programming language built for statistical computing. R’s popularity has continued to grow and is becoming a mainstay in the data science community. Unlike SAS, R is supported by its users. Anybody with the technical know-how can write their own functions to be used by the R community. However, because it is supported by its users, there are often many ways to do the same task in R.</p>
<div id="workflow" class="section level4">
<h4>Workflow</h4>
<p>We recommend that you create a categorical folder on your computer with separate sub-folders for each homework assignment. For assignments in which we provide you with a data file, you should also create a data sub-folder within the appropriate homework folder. Doing the above will help create a clear workspace.</p>
<p>When using R your new workflow should be:</p>
<ul>
<li>open R studio</li>
<li>create a new project</li>
<li>create a new r script</li>
<li>type code in r script</li>
<li>run code in r console</li>
</ul>
<p>Always remember to save your work often.</p>
<ul>
<li>To create a new project: <em>File &gt; New Project… &gt; Existing Directory &gt; Browse &gt; select appropriate homework folder &gt; create project</em></li>
<li>To create a new script: <em>File &gt; New File &gt; R Script</em></li>
<li>To run code: either copy and paste code in your script to the console or highlight code and press <em>Ctrl + Enter (Windows)</em> or <em>Command + Enter (Mac)</em></li>
<li>To save a script: <em>File &gt; Save As</em></li>
</ul>
<p>Using R projects encourages organization. It also sets up a working directory which allows you to use relative paths. Relative paths let you specify shortened file paths instead of full ones. For example, it’s much simpler and cleaner to write <code>data\my_data.csv</code> than <code>C:\\my_computer\categorical\homework_10\data\my_data.csv</code>.</p>
<p>All R code is run in the console. However, this does not mean you should actually type your code there. Code submitted in the console cannot be edited once run and is not saved. Instead, you should write code in R scripts. Scripts can be edited, saved, and simplify collaboration. As an example, try running <code>4 + 2</code> in both the console and an R script.</p>
</div>
<div id="packages" class="section level4">
<h4>Packages</h4>
<p>Bundles of R functions are found in packages that can be installed and then used. The R functions within this document come from a variety of packages. To use these functions please install the following packages by running:</p>
<p><code>install.packages(c("tidyverse", "descr", "descTools", "surival", "epitools", "Hmisc", "devtools"))</code></p>
<p>In addition, you will need to run in your console window, <code>devtools::install_github("nt-williams/catfun")</code>. <em>catfun</em> (because Categorical is fun) is a package currently under development by the Categorical team to improve R’s functionality for categorical data analysis.</p>
<p>Because this is not a course on statistical computing, we will spend minimal time on the finer details of R. If you would like a more comprehensive guide to the basics of R, these are good resources:</p>
<ul>
<li>Getting started and best practices from <a href="http://p8105.com/best_practices.html">P8105</a> taught by Jeff Goldsmith</li>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a> by Garrett Grolemund and Hadley Wickham</li>
</ul>
</div>
</div>
<div id="a-tidy-mindset" class="section level3">
<h3>A tidy mindset</h3>
<p>Different “philosophies” exist on how to program in R. Many stick to programming in what’s called base R, while the examples throughout this site use a “tidy” mindset. Under the “tidy” mindset, code is formatted in a very specific way so that it is reproducible and easy to follow. More information can be found <a href="https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html">here</a>.</p>
</div>
<div id="importing-data" class="section level3">
<h3>Importing data</h3>
<p>We will only be working with csv data files in this course. To import a csv file, we recommend using the <code>read_csv()</code> function from the <em>readr</em> package. The only required argument to <code>read_csv()</code> is the file path in quotation marks. <code>read_csv()</code> will automatically add column names and choose variable types (i.e. character, numeric, date, etc.). Column names usually come from the first row of your dataset.</p>
<pre class="r"><code>library(readr)

example_df &lt;- read_csv(&quot;../data/AZT.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   aids = col_double(),
##   azt = col_double(),
##   race = col_double()
## )</code></pre>
<p>In the above example, we saved the imported dataset as an R object called <code>example_df</code> using <code>&lt;-</code> (keyboard shortcut: <em>Alt + -</em>). We can now call <code>example_df</code> in functions. For example, we can use the <code>head()</code> function to look at the first five observations in the newly imported dataset. If you want to look at the entire dataset, use the function <code>View()</code>. If you wanted to know how many observations or how many variables were in a dataset you could call <code>nrow()</code> or <code>ncol()</code>.</p>
<pre class="r"><code>head(example_df)</code></pre>
<pre><code>## # A tibble: 6 x 3
##    aids   azt  race
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1     1
## 2     1     1     1
## 3     1     1     1
## 4     1     1     1
## 5     1     1     1
## 6     1     1     1</code></pre>
<p>Data for homework can be found on Courseworks under the appropriate homework folders.</p>
</div>
<div id="cross-tabulation" class="section level3">
<h3>Cross-tabulation</h3>
<p>Making cross-tabulations in R can be done a variety of ways. One of the preferred methods is to use the function <code>xtabs()</code>. The minimum syntax for <code>xtabs()</code> is:</p>
<pre class="r"><code>xtabs(&lt;weighting variable or counts&gt; ~ &lt;row variable&gt; + &lt;column variable&gt;, data = &lt;insert dataset&gt;)</code></pre>
<p>The weighting or count variable should only be included if you were given group-level instead of individual-level data. For example, let’s look at the built-in R dataset <code>esoph</code>. You can load the data by calling <code>data(esoph)</code>. First, call <code>head(esoph)</code> and notice the two variables <code>ncases</code> and <code>ncontrols</code>. The names of the variables indicate that this dataset contains group-level data. Looking at the first row of data we can conclude that in this study there were 40 individuals in the control group whose age was between 25-34, used 0-39g of alcohol per day, and used 0-9g of tobacco per day. We can also call <code>nlevels()</code> on the variables <code>alcgp</code> and <code>agegp</code> to see how many factor levels exist in each.</p>
<pre class="r"><code>head(esoph)</code></pre>
<pre><code>##   agegp     alcgp    tobgp ncases ncontrols
## 1 25-34 0-39g/day 0-9g/day      0        40
## 2 25-34 0-39g/day    10-19      0        10
## 3 25-34 0-39g/day    20-29      0         6
## 4 25-34 0-39g/day      30+      0         5
## 5 25-34     40-79 0-9g/day      0        27
## 6 25-34     40-79    10-19      0         7</code></pre>
<pre class="r"><code>nlevels(esoph$alcgp)</code></pre>
<pre><code>## [1] 4</code></pre>
<pre class="r"><code>nlevels(esoph$agegp)</code></pre>
<pre><code>## [1] 6</code></pre>
<p>Let’s now create a cross-tabulation of the number of controls with alcohol group as the rows and age group as the columns; this should result in a 4x6 table.</p>
<pre class="r"><code>xtabs(ncontrols ~ alcgp + agegp, data = esoph)</code></pre>
<pre><code>##            agegp
## alcgp       25-34 35-44 45-54 55-64 65-74 75+
##   0-39g/day    61    89    78    89    71  27
##   40-79        45    80    81    84    53  12
##   80-119        5    20    39    43    29   2
##   120+          5    10    15    26     8   3</code></pre>
<p>If your dataset contained individual-level data you would simply drop the weight/count variable. For example, the dataset <code>example_df</code> (which we previously imported) contains individual-level data, thus there is no weight or count variable.</p>
<pre class="r"><code>xtabs(~ aids + azt, data = example_df)</code></pre>
<pre><code>##     azt
## aids   0   1
##    0 124 145
##    1  44  25</code></pre>
<p><code>xtabs()</code> produces very sparse tables. If you are looking for more informative tables try the <code>crosstab()</code> function from the <em>descr</em> package (see Hypothesis tests section below).</p>
</div>
<div id="hypothesis-tests" class="section level3">
<h3>Hypothesis tests</h3>
<p>Use the following table to locate functions for hypothesis tests. If you are unsure of the usage of a function run <code>?&lt;insert function&gt;</code>. For many of these tests, there are multiple functions that one could use; these are the one’s we have found to work best. Lecture numbers are linked to examples.</p>
<table>
<thead>
<tr class="header">
<th>Hypothesis test</th>
<th>R function</th>
<th>Package</th>
<th align="center">Lecture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Confidence intervals, proportions</td>
<td><code>prop_test()</code></td>
<td>catfun</td>
<td align="center"><a href="ci_single_proportion.html">3</a></td>
</tr>
<tr class="even">
<td>One sample test proportions, normal approximation</td>
<td><code>prop_test()</code></td>
<td>catfun</td>
<td align="center"><a href="hypothesis_single_prop.html">4</a></td>
</tr>
<tr class="odd">
<td>One sample test proportions, exact</td>
<td><code>prop_test()</code></td>
<td>catfun</td>
<td align="center"><a href="hypothesis_single_prop.html">4</a></td>
</tr>
<tr class="even">
<td>Chi-squared</td>
<td><code>CrossTable(..., chisq = TRUE)</code></td>
<td>descr</td>
<td align="center"><a href="chi_squared_fisher.html">8</a></td>
</tr>
<tr class="odd">
<td>Fisher’s exact</td>
<td><code>CrossTable(..., fisher = TRUE)</code></td>
<td>descr</td>
<td align="center"><a href="chi_squared_fisher.html">8</a></td>
</tr>
<tr class="even">
<td>Likelihood ratio test</td>
<td><code>GTest()</code></td>
<td>DescTools</td>
<td align="center"><a href="lrt_2_sample.html">9</a></td>
</tr>
<tr class="odd">
<td>Two sample test for proportions</td>
<td><code>prop_test()</code></td>
<td>catfun</td>
<td align="center"><a href="lrt_2_sample.html">9</a></td>
</tr>
<tr class="even">
<td>Logistic regression</td>
<td><code>glm(..., family = binomial)</code></td>
<td>stats</td>
<td align="center">13, 14, &amp; 15</td>
</tr>
<tr class="odd">
<td>GOF &amp; Hosmer Lemeshow</td>
<td>TBD</td>
<td>TBD</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td>Breslow Day test</td>
<td><code>BreslowDayTest</code></td>
<td>DescTools</td>
<td align="center">19</td>
</tr>
<tr class="odd">
<td>Cochran-Mantel-Haenszel test</td>
<td>TBD</td>
<td>TBD</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td>McNemar’s test</td>
<td><code>CrossTable(..., mcnemar = TRUE)</code></td>
<td>descr</td>
<td align="center">21</td>
</tr>
<tr class="odd">
<td>Conditional logistic regression</td>
<td><code>clogit()</code></td>
<td>survival</td>
<td align="center">22</td>
</tr>
<tr class="even">
<td>Cochran Armitage Trend test</td>
<td><code>CocrhanArmitageTest()</code></td>
<td>DescTools</td>
<td align="center">23</td>
</tr>
</tbody>
</table>
</div>
<div id="measures-of-association" class="section level3">
<h3>Measures of association</h3>
<p>Use the following table to locate functions for measures of association. If you are unsure of the usage of a function run <code>?&lt;insert function&gt;</code>. Lecture numbers are linked to examples.</p>
<table>
<thead>
<tr class="header">
<th>Measure</th>
<th>R function</th>
<th>Package</th>
<th align="center">Lecture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Odds ratio (2 x k table)</td>
<td><code>oddsratio()</code></td>
<td>epitools</td>
<td align="center"><a href="measures_association.html">5 &amp; 7</a></td>
</tr>
<tr class="even">
<td>Risk ratio (2 x k table)</td>
<td><code>riskratio()</code></td>
<td>epitools</td>
<td align="center"><a href="measures_association.html">5 &amp; 7</a></td>
</tr>
<tr class="odd">
<td>Risk difference</td>
<td><code>riskdiff()</code></td>
<td>catfun</td>
<td align="center"><a href="measures_association.html">5 &amp; 7</a></td>
</tr>
</tbody>
</table>
</div>
<div id="power" class="section level3">
<h3>Power</h3>
<p>Use the following table to locate functions for power analyses. If you are unsure of the usage of a function run <code>?&lt;insert function&gt;</code>. Lecture numbers are linked to examples.</p>
<table>
<thead>
<tr class="header">
<th>Power analysis</th>
<th>R function</th>
<th>Package</th>
<th align="center">Lecture</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Power from sample size</td>
<td><code>power.prop.test()</code></td>
<td>stats</td>
<td align="center"><a href="power.html">10</a></td>
</tr>
<tr class="even">
<td>Sample size from power (balanced)</td>
<td><code>power.prop.test()</code></td>
<td>stats</td>
<td align="center"><a href="power.html">10</a></td>
</tr>
<tr class="odd">
<td>Sample size from power (unbalanced)</td>
<td><code>bsamsize()</code></td>
<td>Hmisc</td>
<td align="center"><a href="power.html">10</a></td>
</tr>
</tbody>
</table>
</div>

<br><br>
<center>
<footer>
  <img src="biostat_categorical.png" alt="stickers" style="width:30%">
  <br>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
