---
title: "R"
output:
  html_document: 
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(epitools)
library(DescTools)
library(descr)
library(survival)
library(catfun)

data(esoph)

azt <- read_csv("../data/AZT.csv")

azt <- azt %>% 
  mutate(aids = as.factor(aids), 
         aids = fct_relevel(aids, "1", "0"), 
         azt = as.factor(azt), 
         azt = fct_relevel(azt, "1", "0"))
```

### Getting started

This document is intended to be used as a guide to R for P8120 (Analysis of Categorical Data). This document is not exhaustive; please consult one of the TAâ€™s, Dr. Mauro, or the internet for more help if needed. R can be downloaded [here](https://www.r-project.org/) and R Studio (an IDE reccomended when using R) can be dowloaded [here](https://www.rstudio.com/products/rstudio/download/).

R is an open-source functional programming language built for statistical computing. R's popularity has continued to grow and is becoming one of the main-stays in the Data Science community. Unlike SAS, R is supported by it's users. Anybody with the technical know-how can write their own functions to be used by the R community. However, because it is supported by its users, there is not one way to do any task in R. 

Bundles of R functions are found in packages that can be installed and then used. The R functions within this document come from a variety of packages. To use these functions please intsall the following packages by running: 

`install.packages(c("tidyverse", "descr", "descTools", "surival", "epitools"))` 

In addition, you will need to run, `devtools::install_github("nt-williams/catfun")`. *catfun* (think Categorical is fun) is a package currently underdevelopment by the Categorical team to improve R's functionality for categorical data analysis.

### A tidy mindset

### Importing data

We will only be working with csv datafiles in this course. To import a csv file, we recommend using the `read_csv()` function from the *readr* package. The only required argument to `read_csv()` is the file path in quotation marks. `read_csv()` will automatically add column names and choose variable types (i.e. character, numeric, date, etc.). 

```{r}
library(readr)

example_df <- read_csv("../data/AZT.csv")
```

Use the `head()` function to look at the first five observations in your newly imported dataset. If you want to look at the entire dataset, use the function `View()`

```{r}
head(example_df)
```


### Cross-tabulation

Making cross-tabulalations in R can be done a variety of ways. One of the preferred methods is to use the function `xtabs()`

```{r}
xtabs(ncontrols ~ alcgp + agegp, data = esoph)
```


```{r xtabs example}
# data(esoph)
# 
# xtabs(ncontrols ~ alcgp + agegp, data = esoph)
# 
# xtabs(~ aids + azt, data = azt) %>% 
#   oddsratio(method = "wald") 
# 
# xtabs(~ aids + azt, data = azt) %>% 
#   riskratio(method = "wald")
```


### Hypothesis tests

Use the following table to locate functions for hypothesis tests. If you are unsure of the usage of a function type `?<insert function>`

|Hypothesis test                     | R function                     | Package          |Lecture    |
|------------------------------------|--------------------------------|------------------|:-----------:|
|Confidence intervals, proportions   | `prop_test()`                    | catfun        |[3](ci_single_proportion.html) |
|One sample test proportions, normal approximation  |`prop_test()`| catfun            |[4](hypothesis_single_prop.html)|
|One sample test proportions, exact   | `prop_test()`            | catfun           |[4](hypothesis_single_prop.html)|
|Chi-squared                         | `crosstab(..., chisq = TRUE)` | descr             |           |
|Fisher's exact                      | `crosstab(..., fisher = TRUE)`| descr             |           |
|McNemar's test                      | `crosstab(..., mcnemar = TRUE)`   | descr         |           |
|Logistic regression                 | `glm(..., family = binomial)`  | stats            |           |
|GOF & Hosmer Lemeshow               | TBD                            | TBD              |           |
|Conditional logistic regression     | `clogit()`                     | survival         |           |
|Cochran Armitage Trend test         | `CocrhanArmitageTest()`        | DescTools        |           |
|Breslow Day test                    | `BreslowDayTest`               | DescTools        |           |

### Measures of association

| Measure               | R function         | Package  |Lecture  |
|-----------------------|--------------------|----------|---------|
|Odds ratio (2xk table) | `oddsratio()`      | epitools |         |
|Risk ratio (2xk table) | `riskratio()`      | epitools |         |
|Risk difference        | `riskdiff()`       | catfun   |         |
         
### Power

Fun

