---
title: "R"
output:
  html_document: 
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(epitools)
library(DescTools)
library(descr)
library(survival)
library(catfun)

data(esoph)

azt <- read_csv("../data/AZT.csv")

azt <- azt %>% 
  mutate(aids = as.factor(aids), 
         aids = fct_relevel(aids, "1", "0"), 
         azt = as.factor(azt), 
         azt = fct_relevel(azt, "1", "0"))
```

### Getting started

This document is intended to be used as a guide to R for P8120 (Analysis of Categorical Data). This document is not exhaustive; please consult one of the TAâ€™s, Dr. Mauro, or the internet for more help if needed. R can be downloaded [here](https://www.r-project.org/) and R Studio (an IDE recommended when using R) can be downloaded [here](https://www.rstudio.com/products/rstudio/download/).

R is an open-source functional programming language built for statistical computing. R's popularity has continued to grow and is becoming one of the main-stays in the Data Science community. Unlike SAS, R is supported by it's users. Anybody with the technical know-how can write their own functions to be used by the R community. However, because it is supported by its users, there is not one way to do any task in R. 

Bundles of R functions are found in packages that can be installed and then used. The R functions within this document come from a variety of packages. To use these functions please install the following packages by running: 

`install.packages(c("tidyverse", "descr", "descTools", "surival", "epitools"))` 

In addition, you will need to run, `devtools::install_github("nt-williams/catfun")`. *catfun* (think Categorical is fun) is a package currently underdevelopment by the Categorical team to improve R's functionality for categorical data analysis.

Because this is not a course on statistical computing, we will spend minimal time on the finer details of R. If you would like a more comprehensive guide to the basics of R these are good resources: 

- Getting started and best practices from [P8105](http://p8105.com/best_practices.html) taught by Jeff Goldsmith
- [R for Data Science](https://r4ds.had.co.nz/) by Garrett Grolemund and Hadley Wickham

### A tidy mindset

Different "philosophies" exist on how to program in R. Many stick to programming in what's called base R while the examples throughout this site use what could be called a "tidy" mindset. That is, code is formatted and (for the most part) uses functions/packages that is reproducible and easy to follow. More information can be found [here](https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html).

### Importing data

We will only be working with csv data files in this course. To import a csv file, we recommend using the `read_csv()` function from the *readr* package. The only required argument to `read_csv()` is the file path in quotation marks. `read_csv()` will automatically add column names and choose variable types (i.e. character, numeric, date, etc.). 

```{r}
library(readr)

example_df <- read_csv("../data/AZT.csv")
```

Use the `head()` function to look at the first five observations in your newly imported dataset. If you want to look at the entire dataset, use the function `View()`

```{r}
head(example_df)
```

### Cross-tabulation

Making cross-tabulations in R can be done a variety of ways. One of the preferred methods is to use the function `xtabs()`

The minimum syntax for `xtabs()` is: 

```{r eval = FALSE}
xtabs(<weighting variable> ~ <row variable> + <column variable>, data = <insert dataset>)
```

This example uses a dataset builds a cross-tabulation from summary data. The variable 'ncontrols' contains the counts per group which is why it is before the tilde.

```{r}
xtabs(ncontrols ~ alcgp + agegp, data = esoph)
```

In this example, the dataset `example_df` is individual level data, thus there is no weighting variable.  

```{r}
xtabs(~ aids + azt, data = example_df)
```

`xtabs()` produces very sparse tables. If you are looking for more informative tables try the `crosstab()` function from the *descr* package (see table below).

### Hypothesis tests

Use the following table to locate functions for hypothesis tests. If you are unsure of the usage of a function type `?<insert function>`

|Hypothesis test                     | R function                     | Package          |Lecture    |
|------------------------------------|--------------------------------|------------------|:---------:|
|Confidence intervals, proportions   | `prop_test()`                  | catfun        |[3](ci_single_proportion.html) |
|One sample test proportions, normal approximation  |`prop_test()`| catfun            |[4](hypothesis_single_prop.html)|
|One sample test proportions, exact   | `prop_test()`            | catfun           |[4](hypothesis_single_prop.html)|
|Chi-squared                         | `crosstab(..., chisq = TRUE)` | descr             |           |
|Fisher's exact                      | `crosstab(..., fisher = TRUE)`| descr             |           |
|McNemar's test                      | `crosstab(..., mcnemar = TRUE)`   | descr         |           |
|Logistic regression                 | `glm(..., family = binomial)`  | stats            |           |
|GOF & Hosmer Lemeshow               | TBD                            | TBD              |           |
|Conditional logistic regression     | `clogit()`                     | survival         |           |
|Cochran Armitage Trend test         | `CocrhanArmitageTest()`        | DescTools        |           |
|Breslow Day test                    | `BreslowDayTest`               | DescTools        |           |

### Measures of association

| Measure               | R function         | Package  |Lecture                               |
|-----------------------|--------------------|----------|:------------------------------------:|
|Odds ratio (2 x k table) | `oddsratio()`      | epitools |[5 & 7](measures_association.html)    |
|Risk ratio (2 x k table) | `riskratio()`      | epitools |[5 & 7](measures_association.html)    |
|Risk difference        | `riskdiff()`       | catfun   |[5 & 7](measures_association.html)    |
         
### Power

Fun

