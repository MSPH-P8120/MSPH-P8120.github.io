---
title: "Power"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(SASmarkdown)
```

# {.tabset .tabset-fade}

## R

The *pwr* package has a variety of functions for conducting power analyses. It is important to note, however, that these functions to not return the exact same results as SAS. 

### Computing power for fixed sample size

The `power.prop.test()` function can be used to calculate power for equal group sample sizes. For unbalanced group sample sizes, the package *Hmisc* has a series of functions that can be used. 

```{r warning = FALSE}
power.prop.test(n = 110, 
                p1 = 0.35, p2 = 0.2, 
                sig.level = 0.05)
```

### Computing sample size given power (balanced)

The `power.prop.test()` function can also be used to calculate sample size given power. Instead of specifying the number of observations per group, we specify the desired power. 

```{r}
power.prop.test(p1 = 0.35, p2 = 0.2, 
                power = 0.80, 
                sig.level = 0.05)
```

### Computing sample size given power (unbalanced)

The `bsamsize()` function can be used to calculate unbalanced sample sizes. The fraction argument is set to 2/3 indicating that 2/3 of the total sample will be members of group one. 

```{r message = FALSE, warning = FALSE}
library(Hmisc)

bsamsize(p1 = 0.35, p2 = 0.2, 
         fraction = 2/3, 
         alpha = 0.05, 
         power = 0.85)
```

## SAS

Power analyses in SAS are conducting using the power procedure. 

### Computing power for fixed sample size

```{sas, engine.path = "C:/Program Files/SASHome/SASFoundation/9.4/sas.exe", error = FALSE}
title1 'Computing Power Given Sample Size';
proc power; 
  twosamplefreq test = pchi
  alpha = 0.05
  groupproportions = (0.35 0.20)
  nullproportiondiff = 0
  groupweights = (1 1)
  ntotal = 220
  power = .;
run;
```

### Computing sample size given power (balanced)

```{sas, engine.path = "C:/Program Files/SASHome/SASFoundation/9.4/sas.exe", error = FALSE}
title1 'Computing Sample Size Given Power';
proc power; 
  twosamplefreq test = pchi
  alpha = 0.05
  groupproportions = (0.35 0.20)
  nullproportiondiff = 0
  npergroup = .
  power = 0.80;
run;
```

### Computing sample size given power (unbalanced)

```{sas, engine.path = "C:/Program Files/SASHome/SASFoundation/9.4/sas.exe", error = FALSE}
title1 'Computing Sample Size Given Power (Unbalanced Groups)';
proc power; 
  twosamplefreq test = pchi
  alpha = 0.05
  groupproportions = (0.35 0.20)
  nullproportiondiff = 0
  groupweights = (2 1)
  ntotal = .
  power = 0.85;
run;
```


